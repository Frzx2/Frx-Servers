#:import MDTextField kivymd.uix.textfield.MDTextField
#:import MDDialog kivymd.uix.dialog.MDDialog
#:import MDFlatButton kivymd.uix.button.MDFlatButton
#:import MDRaisedButton kivymd.uix.button.MDRaisedButton

# --- Custom List Item ---
<FileManagerItem>:
    on_release: app.root.get_screen('server_file').item_released(self)

    theme_text_color: "Custom"
    text_color: 1, 1, 1, 1  # force white text

    IconLeftWidget:
        icon: "folder" if root.is_folder else "file-outline"
        theme_text_color: "Custom"
        text_color: 1, 1, 1, 1  # white icon

# --- Main File Manager Screen ---
<Server_File>:
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: 0.1, 0.1, 0.12, 1  # dark overall background

        # Top App Bar
        MDTopAppBar:
            title: "Server File Manager"
            elevation: 6
            md_bg_color: 0.1, 0.1, 0.12, 1
            specific_text_color: 1, 1, 1, 1

        MDBoxLayout:
            orientation: "horizontal"

            # LEFT PANEL (Controls & Logs)
            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.35
                padding: "12dp"
                spacing: "12dp"
                md_bg_color: 0.12, 0.12, 0.15, 1  # dark gray for panel

                MDLabel:
                    text:"Location: " + root.current_path
                    font_style: "Caption"
                    halign: "center"
                    size_hint_y: None
                    height: self.texture_size[1]
                    shorten: True
                    shorten_from: 'left'
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1

                MDRaisedButton:
                    text: "Back"
                    md_bg_color: 0.4, 0.2, 0.6, 1  # vibrant violet
                    text_color: 1, 1, 1, 1
                    on_release: root.go_back()

                MDSeparator:
                    color: 0.4, 0.4, 0.4, 1

                MDRaisedButton:
                    text: "New Folder"
                    icon: "folder-plus"
                    md_bg_color: 0.2, 0.6, 0.4, 1  # greenish vibrant
                    text_color: 1, 1, 1, 1
                    on_release: root.create_folder_dialog()

                MDRaisedButton:
                    text: "Rename"
                    icon: "pencil"
                    md_bg_color: 0.6, 0.5, 0.2, 1  # gold/yellow
                    text_color: 1, 1, 1, 1
                    on_release: root.rename_item_dialog()

                MDRaisedButton:
                    text: "Import"
                    icon: "import"
                    md_bg_color: 0.2, 0.5, 0.7, 1  # cyan/blue
                    text_color: 1, 1, 1, 1
                    on_release: root.import_files_dialog()

                MDRaisedButton:
                    text: "Delete"
                    icon: "delete"
                    md_bg_color: 0.8, 0.2, 0.2, 1  # red
                    text_color: 1, 1, 1, 1
                    on_release: root.show_delete_confirmation()

                MDLabel:
                    text: "Logs:"
                    font_style: "Subtitle1"
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1
                    size_hint_y: None
                    height: "30dp"
                    padding_y: "10dp"

                ScrollView:
                    MDLabel:
                        id: log_label
                        text: "Welcome!"
                        font_style: "Caption"
                        size_hint_y: None
                        height: self.texture_size[1]
                        padding: 5, 5
                        theme_text_color: "Custom"
                        text_color: 1, 1, 1, 1

            # RIGHT PANEL (File List)
            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.65
                padding: "10dp"
                spacing: "5dp"
                RecycleView:
                    id: file_list
                    viewclass: "FileManagerItem"
                    scroll_type: ['bars', 'content']
                    bar_width: "10dp"

                    RecycleBoxLayout:
                        padding: 10
                        default_size: None, dp(56)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"

    # BOTTOM NAVIGATION BAR
    MDCard:
        id: bottom_menu_card
        orientation: "horizontal"
        size_hint_y: None
        height: "60dp"
        padding: "10dp"
        spacing: "20dp"
        md_bg_color: 0.12, 0.12, 0.15, 1
        radius: [20, 20, 0, 0]
        elevation: 6

        MDLabel:
            id: tab_status
            text: "Server Status"
            halign: "center"
            font_style: "Button"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            on_touch_down: if self.collide_point(*args[1].pos): root.set_screen("status")

        MDLabel:
            id: tab_players
            text: "Players"
            halign: "center"
            font_style: "Button"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            on_touch_down: if self.collide_point(*args[1].pos): root.set_screen("players")

        MDLabel:
            id: tab_console
            text: "Console"
            halign: "center"
            font_style: "Button"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            on_touch_down: if self.collide_point(*args[1].pos): root.set_screen("console")

        MDLabel:
            id: tab_logs
            text: "Logs"
            halign: "center"
            font_style: "Button"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            on_touch_down: if self.collide_point(*args[1].pos): root.set_screen("server_file")

        MDLabel:
            id: tab_props
            text: "Properties"
            halign: "center"
            font_style: "Button"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            on_touch_down: if self.collide_point(*args[1].pos): root.set_screen("server_properties")

        MDLabel:
            id: tab_home
            text: "Home"
            halign: "center"
            font_style: "Button"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            on_touch_down: if self.collide_point(*args[1].pos): root.set_screen("homescreen")
